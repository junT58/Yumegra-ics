(function(){let e=function(){if(!location.href.match(/http[s]*:\/\/(www.)*yumenographia.com\/#\/mypage/))return void alert("マイページで実行してください。");const e=window.prompt("出力モードを入力してください。\nall = 所有チケットすべて, diff = まだ出力していないチケット, last = 前回の結果も含めたチケット","diff");if(null==e)return;const t=window.prompt("予定タイトルの形式を入力してください。\n以下の値が使用できます。\n%name% = キャスト名, %date% = 日付, %start% = 開始時刻, %end% = 終了時刻, %id% = チケットID","ユメノグラフィア %name% (%id%)");if(null==t)return;let n=window.prompt("タイムゾーンを入力してください。","Asia/Tokyo");null==n&&(n="Asia/Tokyo"),null==localStorage.getItem("yg_export")&&localStorage.setItem("yg_export",JSON.stringify({last_exported:[],exported:[]}));const a=JSON.parse(localStorage.getItem("yg_export")),l=[],r=[];let s="BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//COMPANY///Yumegra Ticket Calendar//JP\n";if(Array.prototype.forEach.call(document.getElementsByClassName("ticket-wrap"),function(i){const o=i.getElementsByClassName("ticket-card__content");if(o.length<=0)return void alert("チケット情報が取得できませんでした。");const c=o.item(0),d=c.getElementsByClassName("ticket-card__visitTime").item(0).innerHTML.split(" - "),p=c.getElementsByClassName("ticket-card__visitDate").item(0).innerHTML.replace(/ \(.{3}\)/,"").split(".");var m=new Date(parseInt(p[0]),parseInt(p[1])-1,parseInt(p[2])+(parseInt(d[0].split(":")[0])>parseInt(d[1].split(":")[0])?1:0));const g=`${m.getFullYear()}${("0"+(1+m.getMonth())).slice(-2)}${("0"+m.getDate()).slice(-2)}`,u=c.getElementsByClassName("ticket-card__ticket_id").item(0).innerHTML.replace("code:","");r.push(u);let I=t.replace(/%name%/g,c.getElementsByClassName("ticket-card__name").item(0).innerHTML).replace(/%date%/g,`${p[0]}/${p[1]}/${p[2]}`).replace(/%start%/g,d[0]).replace(/%end%/g,d[1]).replace(/%id%/g,u),E=`BEGIN:VEVENT\nDTSTART;TZID=${n}:${p[0]}${p[1]}${p[2]}T${d[0].replace(":","")}00\nDTEND;TZID=${n}:${g}T${d[1].replace(":","")}00\nSUMMARY:${I}\nBEGIN:VALARM\nACTION:DISPLAY\nTRIGGER:-P15M\nDESCRIPTION:15分後にチケットがあります。\nEND:VALARM\nBEGIN:VALARM\nACTION:DISPLAY\nTRIGGER:-P30M\nDESCRIPTION:30分後にチケットがあります。\nEND:VALARM\nUID:${u}\nEND:VEVENT\n`;"diff"==e?a.exported.includes(u)||(s+=E,l.push(u)):"last"==e&&a.exported.includes(u)&&!a.last_exported.includes(u)||(s+=E,l.push(u))}),!(l.length<=0))return a.last_exported=l,a.exported=r,localStorage.setItem("yg_export",JSON.stringify(a)),s+="END:VCALENDAR";alert("条件に合致するチケットがありませんでした。")}();null!=e&&function(...e){return new Promise(t=>{const n=new FileReader;n.onload=(()=>{const e=n.result.indexOf(",")+1;t(n.result.slice(e))}),n.readAsDataURL(new Blob(e))})}(e).then(e=>{const t=document.createElement("a");t.href="data:text/calendar;base64;charset=utf8,"+e,t.download="calendar.ics",document.body.appendChild(t),t.click(),document.body.removeChild(t)})})();